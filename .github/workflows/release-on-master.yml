name: Android Test Build

on:
  push:
    branches: [ main, master ] # æ¨é€åˆ°ä¸»åˆ†æ”¯æ—¶è§¦å‘
  pull_request:
    branches: [ main, master ] # åˆ›å»ºPRæ—¶ä¹Ÿè§¦å‘
  workflow_dispatch: # å…è®¸åœ¨GitHubé¡µé¢ä¸Šæ‰‹åŠ¨è§¦å‘

jobs:
  test-build:
    name: Build Debug APK
    runs-on: ubuntu-latest

    steps:
    # ç¬¬ä¸€æ­¥ï¼šè·å–ä»£ç 
    - name: Checkout code
      uses: actions/checkout@v4

    # ç¬¬äºŒæ­¥ï¼šè®¾ç½®Javaç¯å¢ƒ
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    # ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®Android SDKï¼ˆä½¿ç”¨å®˜æ–¹æ¨èçš„ç¬¬ä¸‰æ–¹actionï¼‰
    - name: Setup Android SDK
      uses: android-actions/setup-android@v2
      # è¿™ä¸ªactionä¼šè‡ªåŠ¨å®‰è£…SDKå¹¶æ¥å—è®¸å¯è¯

    # ç¬¬å››æ­¥ï¼šç¡®ä¿gradlewæœ‰æ‰§è¡Œæƒé™
    - name: Make gradlew executable
      run: chmod +x ./gradlew

    # ç¬¬äº”æ­¥ï¼šæ„å»ºè°ƒè¯•ç‰ˆAPKï¼ˆæ— éœ€ç­¾åï¼‰
    - name: Build Debug APK
      run: ./gradlew assembleDebug --stacktrace --no-daemon

    # ç¬¬å…­æ­¥ï¼šä¸Šä¼ æ„å»ºäº§ç‰©ä¾›ä¸‹è½½
    - name: Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: app-debug-apk
        path: |
          app/build/outputs/apk/debug/*.apk
          app/build/outputs/apk/debug/output.json
        retention-days: 7

    # ç¬¬ä¸ƒæ­¥ï¼šå¯é€‰ - æ˜¾ç¤ºæ„å»ºæˆåŠŸä¿¡æ¯
    - name: Build succeeded âœ…
      run: |
        echo "ğŸ‰ Androidæµ‹è¯•æ„å»ºæˆåŠŸï¼"
        echo "ğŸ“¦ APKæ–‡ä»¶å¯åœ¨å³ä¾§ArtifactsåŒºåŸŸä¸‹è½½"
        echo "ğŸ› ï¸  æ„å»ºäº: $(date)"